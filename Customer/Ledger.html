<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="google" content="notranslate" />    
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sports Trading Platform">
    <meta name="keyword" content="sports trading, bet, betfair">
    <meta name="robots" content="noindex" />

    <link rel="shortcut icon" href="/img/favicon/BetPro.ico">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/img/sprites/css/sprite.css" />
    <link rel="stylesheet" href="/dist/site.css" />
    <link href="/css/BetPro-style.css" rel="stylesheet" />

    <title>Account Ledger | BetPro</title>
    <style>
        .body {
            min-height: 91.7vh;
        }

        center a {
            color: white;
        }

        center a {
            font-size: 13px;
        }
    </style>

    <script>
        const pricesUrl = "https://prices9.mgs11.com/api";
        const ordersUrl = "https://orders.mgs11.com/api";
        const LiquidityRate = 35;
        const SsocketUrl = "https://orders-ws2.mgs11.com/signalr";
        const uwsUrl = "https://orders-ws2.mgs11.com/usershub";
        const genSck = 1;
        const CasSck = 1;
        const casinoUrl = "https://casino-ws.mgs11.com/signalr";
        // var SsocketEnable = 0;
    </script>
</head>
<body class="bg-gray d-flex flex-column">
    <div class="main-page">
        <div class="row no-gutters">
            <div class="col-md-3 col-lg-2" id="sidebar">
                <div class="logo-bar">
                    <a href="/Common/Dashboard">
                        <span class="green-logo-text">BetPro</span>
                    </a>
                </div>
                <div class="divider"></div>
                <div class="sidebar-menu" style="height:100%;">
                    <ul>
                        

<ul class="nav">



<style>

    @keyframes spin {
        from {
            transform: rotateY(0deg);
            moz-transform: rotateY(0deg);
            ms-transform: rotateY(0deg);
        }

        to {
            transform: rotateY(360deg);
            moz-transform: rotateY(360deg);
            ms-transform: rotateY(360deg);
        }
    }

    @-webkit-keyframes spin {
        from {
            -webkit-transform: rotateY(0deg);
        }

        to {
            -webkit-transform: rotateY(360deg);
        }
    }

    .imageSpin {
        transition-delay: 5s;
        animation-name: spin;
        animation-iteration-count: infinite;
        animation-duration: inherit;
        -webkit-animation-name: spin;
        -webkit-animation-iteration-count: infinite;
        -webkit-animation-timing-function: initial;
        -webkit-animation-duration: 4s;
        -webkit-animation-delay: 2s;
    }

    .imageSpin2 {
        transition-delay: 3s;
        animation-name: spin;
        animation-iteration-count: infinite;
        animation-duration: inherit;
        -webkit-animation-name: spin;
        -webkit-animation-iteration-count: infinite;
        -webkit-animation-timing-function: initial;
        -webkit-animation-duration: 3s;
        -webkit-animation-delay: 2s;
    }
   

    /*for spin2*/
    #spinning-circle {
        animation-name: spinning-circle;
        animation-duration: 5s;
        animation-iteration-count: infinite;
    }

    @-webkit-keyframes spinning-circle {
        0% {
            -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
        }
    }

    #invertcolor {
        filter: invert(100%);
        -webkit-filter: invert(100%);
        animation-name: spinning-circle;
        animation-duration: 3s;
        animation-iteration-count: infinite;
    }
    #invertcolor2{
         filter: invert(100%);
        -webkit-filter: invert(100%);
       animation-name: spin;
        animation-duration: 4s;
        animation-iteration-count: infinite;
        max-height:30px;
    }

    #invertcolor3 {
        filter: invert(100%);
        -webkit-filter: invert(100%);
        animation-name: spin;
        animation-duration: 3s;
        animation-iteration-count: infinite;
        max-height: 30px;
    }


 .exgameblinker{
   animation: animate 8s linear infinite;
 } 
  
 @keyframes animate{
   0%{
     background-color:red;
   }
   25%{
     background-color:inherit;
   }
   50%{
     background-color:inherit;
   }
   75%{
     background-color:inherit;
   }
   100%{
     background-color:red;
   }
 }

    .Galaxyblinker {
        position: relative;
        z-index: 0;
    }

        .Galaxyblinker::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(90deg, #8a47ff 0%, #c36eff 100%);
            opacity: 1;
            animation: animateGradient 12s linear infinite;
            transition: opacity 0.5s ease;
        }

    @keyframes animateGradient {
        0%, 100%

    {
        opacity: 1;
    }

    25%, 50%, 75% {
        opacity: 0;
    }

    }
.cricketEventList {
  list-style: none;
  padding: 0;
  margin: 0;
}

.match-card {
  /* background-color: #1a1a1a; */
  color: white;
  margin-bottom: 12px;
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 16px;
  box-shadow: 0 2px 6px rgba(255, 255, 255, 0.05);
  transition: background 0.3s ease;
  cursor: pointer;
}

.match-card:hover {
  background-color: #2a2a2a;
}


</style>

    <li style="width:100%;">

            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="svg-soccer svg-soccer-dims svg-span" role="img"></span>
                <span>Soccer</span>
            </a>
            <div class="dropdown-menu" aria-labelledby="nav">
                <ul class="sub-menu" href="#">

                    <li><a href="#"><strong>All Soccer</strong></a></li>
                    <li class="divider"></li>
                            <ul class="footballEventList">
                                </ul>
                </ul>
            </div>
        </li>
        <li style="width:100%;">

            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="svg-tennis svg-tennis-dims svg-span" role="img"></span>
                <span>Tennis</span>
            </a>
            <div class="dropdown-menu" aria-labelledby="nav">
                <ul class="sub-menu" href="#">

                    <li><a href="#"><strong>All Tennis</strong></a></li>
                    <li class="divider"></li>
                            <ul class="tennisEventList">
                            </ul>
                            <!-- </li> -->
                </ul>
            </div>
        </li>
        <li style="width:100%;">

            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="svg-cricket svg-cricket-dims svg-span" role="img"></span>
                <span>Cricket</span>
            </a>
            <div class="dropdown-menu" aria-labelledby="nav">
                <ul class="sub-menu" href="#">

                    <li><a href="#"><strong>All Cricket</strong></a></li>
                    <li class="divider"></li>
                            <ul class="cricketEventList ">
                                <!-- <a class="nav-link" href="/Common/market/?id=1.245405948"> -->
<!-- England v India                                </a> -->
                                </ul>
                            <!-- </li> -->
                </ul>
            </div>
        </li>
        <li style="width:100%;">

            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="svg-horse svg-horse-dims svg-span" role="img"></span>
                <span>Horse Race</span>
            </a>
            <div class="dropdown-menu" aria-labelledby="nav">
                <ul class="sub-menu" href="#">

                    <li><a href="#"><strong>All Horse Race</strong></a></li>
                    <li class="divider"></li>
                            <ul class="horseEventList">
                                <!-- <a class="nav-link" href="/Common/market/?id=1.245481913"> -->
                                        <!-- <span class="market-time"> -->
                                        <!-- </span> -->
                                        <!-- <span class="d-none utctime" data-format="h:mm A"> -->
                                            <!-- 2025-07-10T11:50:00.0000000Z -->
                                        <!-- </span> -->
                                        <!-- <span class="race-venue">Turffontein (ZA)</span> -->
                                        </ul>
                
                            
                            
                
                                

                                        
                            
                            
                                    
    
                
                                            
                    

                                
                                
                
                        
                                
                </ul>
            </div>
        </li>
        <li style="width:100%;">

            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="svg-greyhound-racing svg-greyhound-racing-dims svg-span" role="img"></span>
                <span>Greyhound</span>
            </a>
            <div class="dropdown-menu" aria-labelledby="nav">
                <ul class="sub-menu" href="#">

                    <li><a href="#"><strong>All Greyhound</strong></a></li>
                    <li class="divider"></li>
                            <ul class="greyhounditems">
                                <!-- <a class="nav-link" href="/Common/market/?id=1.245475078"> -->
                                        <!-- <span class="market-time"> -->
                                        <!-- </span> -->
                                        <!-- <span class="d-none utctime" data-format="h:mm A"> -->
                                            <!-- 2025-07-10T12:05:00.0000000Z -->
                                        <!-- </span> -->
                                        <!-- <span class="race-venue">Q1 Lakeside (AU)</span> -->
                                <!-- </a> -->
                            </ul>
                                        
                    
                </ul>
            </div>
        </li>


        <li class="nav-item" style="width:100%;">
            <a href="/Common/sap" class="dropdown-toggle" role="button">
                <span class="svg-Casino svg-Casino-dims imageSpin2" role="img"></span>
                <span>Sports Book</span>
            </a>
        </li>
        <li class="nav-item" style="width:100%;">
            <a href="/Common/RSC" class="dropdown-toggle" role="button">
                <i style="font-size:17px;" class='fas fa-star fa-2x fa-spin fa-lg'></i>
                <span>RoyalStar Casino</span>
            </a>
        </li>
        <li class="nav-item" style="width:100%;">
            <a href="/Common/Games" class="dropdown-toggle" role="button">
                <img id="spinning-circle" src="/img/v2/livegameing.png" onerror="this.onerror = null; this.src= null" alt="G">
                <span>Star Casino</span>
            </a>

        </li>
        <li class="nav-item" style="width:100%;">
            <a class="dropdown-toggle" role="button" href="/Common/WorldCasino">
                <img id="invertcolor" style="background:invert(100%)" src="/img/v2/worldcasinosvg.png" alt="WC" />
                <span>World Casino</span>
            </a>
        </li>
        <li class="nav-item" style="width:100%;">
            <a class="dropdown-toggle" role="button" href="/Common/Dream">
                <span class="svg-Casino svg-Casino-dims imageSpin2" role="img"></span>
                <span>Royal Casino</span>
            </a>
        </li>
        <li class="nav-item" style="width:100%;">
            <a class="dropdown-toggle" role="button" href="/Common/ExGames">
                <img id="invertcolor2" src="/img/v2/BLogo.png" />
                <span>BetFairGames</span>
            </a>
         </li>
        <li class="nav-item exgameblinker" style="width:100%;">
            <a class="dropdown-toggle" role="button" href="/Common/BetProGames">
                <img id="invertcolor3" src="/img/v2/TPS.png" />
                <span>TeenPatti Studio</span>
            </a>
        </li>
        <li class="nav-item Galaxyblinker" style="width:100%;">
            <a class="dropdown-toggle" role="button" href="/Common/Galaxy">
                <img src="/img/v2/Glogo.png" />
                <span>Galaxy Casino</span>
            </a>
        </li>

    <li class="divider"></li>
        <li class="nav-item" style="width:100%;">
            <a class="nav-link" href="/Customer/Liable">
                <span class="svg-colossus svg-colossus-dims svg-span" role="img"></span> 
                Current Position
            </a>
        </li>
        <li class="nav-item" style="width:100%;">
            <a class="nav-link" href="/Common/Dashboard">
                <span class="svg-soccer svg-soccer-dims svg-span" role="img"></span> 
                All Sports
            </a>
        </li>
        <li class="nav-item" style="width:100%;">
            <a class="nav-link" href="/Common/Result">
                <span class="svg-clipboard svg-clipboard-dims svg-span" role="img"></span> 
                Results
            </a>
        </li>
    <li class="nav-item" style="width:100%;">
        <a class="nav-link" href="#" onclick="ShowExchangeRules(); return false;">
            <i class="fa fa-info-circle"></i>Market Rules
        </a>
    </li>
    <li class="nav-item" style="width:100%;">
        <a class="nav-link" href="#" onclick="ShowTos(); return false;">
            <i class="fa fa-info-circle"></i>Terms &amp; Conditions
        </a>
    </li>
</ul>
<script>
    function ShowExchangeRules() {
        $("#modalMarketRules").modal('show');

        $.get("/rules.html", function (data) {
            $("#modalMarketRules .modal-body").html(data);
        });
    }

    function ShowTos() {
        $("#modalTos").modal('show');
        $.get("/tos.html", function (data) {
            $("#modalTos .modal-body").html(data);
        });
    }
</script>
                    </ul>
                </div>
            </div>

            <div class="col-md" id="main-wrap">
                <div class="header">
                    <button class="burger-toggle">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <ul class="top-nav">
                        <li><a href="/Common/Dashboard">Dashboard</a></li>
                    </ul>

                    <div id="sticky-footer" style="width:50vw; padding:0px; margin:0px; float:left; " class="py-1 bg-black text-white">
                        <div class="container text-center" style="padding:0px; margin:0px;">
                            <ul id="news-ticker-foot" style="padding:0px; margin:0px;">
                                <li data-update="item1" style="padding:0px; margin:0px;">Welcome to BetPro</li>
                            </ul>
                        </div>
                    </div>


                    <div class="dropdown-wrap">
                        <div class="dropdown">

                            <div class="designation">
                                <span class="wallet-balance">B: -</span>
                                <span class="wallet-exposure"> | L: - |</span>
                            </div>
 <button class="btn profile-dropdown dropdown-toggle" type="button"  id="navbar-user" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                  
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <a class="dropdown-item" href="/Customer/Ledger/">Statement</a>
                                <a class="dropdown-item" href="/Common/Result/">Result</a>
                                <a class="dropdown-item" href="/Customer/ProfitLoss/">Profit Loss</a>
                                <a class="dropdown-item" href="/Customer/Bets">Bet History</a>
                                <a class="dropdown-item" href="/Customer/Profile">Profile</a>
                                <a class="dropdown-item" id="btn-logout" href="/Common/Logout">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-wrap body">
                    <link rel="stylesheet" type="text/css" href="/lib/datatables/datatables.min.css" />
<link rel="stylesheet" type="text/css" href="/css/ledger.css" />
<style>
    button.dt-button, div.dt-button, a.dt-button {
        padding: 5px;
    }
</style>

<div class="table-wrap">
    
<style>
    .datee {
        background-color: white;
    }
    @media screen and (max-width: 635px) {
        .editsbmtbtn {
            margin: auto;
            margin-right: 15px;
        }
    }
</style>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <i class="fa fa-align-justify"></i>
                Report Filter
            </div>
            <div class="card-body">
                <form id="ReportFilterForm" class="form-inline" method="get">
                    <div class="row" style="text-align-last:justify;">
                        <div class="col-12 col-md-5">
                            <div class="form-group">
                                <div class="input-group date" id="ReportFrom" data-target-input="nearest">
                                    <input type="text"
                                           class="form-control datetimepicker-input"
                                           data-target="#ReportFrom"
                                           id="DisplayFrom" />
                                    <div class="input-group-append" data-target="#ReportFrom" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span class="market-time d-none"></span>
                                <span class="d-none utctime" data-nofirst="0" data-format="M/D/YYYY h:mm A">
                                    2025-06-20T19:00:00.0000000Z
                                </span>
                                <input type="hidden" name="From" id="From" value="2025-06-20T19:00:00.0000000Z" />
                            </div>
                        </div>

                        <strong style="margin:auto">&nbsp;-&nbsp;</strong>
                        <div class="col-12 col-md-5">
                            <div class="form-group">
                                <div class="input-group date" id="ReportTo" data-target-input="nearest">
                                    <input type="text"
                                           class="form-control datetimepicker-input"
                                           data-target="#ReportTo"
                                           id="DisplayTo" />
                                    <div class="input-group-append" data-target="#ReportTo" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span class="market-time d-none"></span>
                                <span class="d-none utctime" data-nofirst="0" data-format="M/D/YYYY h:mm A">
                                    2025-06-21T18:59:59.0000000Z
                                </span>
                                <input type="hidden" name="To" id="To" value="2025-06-21T18:59:59.0000000Z" />
                            </div>
                        </div>

                        <div class="form-group editsbmtbtn">
                            <label class="mx-1"> </label>
                            <button class="btn btn-primary" type="submit" onclick="return updateDates();">
                                <strong>Submit</strong>
                            </button>
                        </div>
                        <input type="hidden" data-val="true" data-val-required="The ClientId field is required." id="ClientId" name="ClientId" value="5810548" />
                        <input type="hidden" data-val="true" data-val-required="The EventTypeId field is required." id="EventTypeId" name="EventTypeId" value="0" />
                        <input type="hidden" data-val="true" data-val-required="The IsFirstVisit field is required." id="IsFirstVisit" name="IsFirstVisit" value="True" />
                    </div>
                    <div class="row col-12">
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

</div>
<div id="ledgerApp" class="table-wrap">
  <div>
    <div class="card">
      <div class="card-header">
        <i class="fa fa-align-justify"></i> Account Ledger
      </div>
      <div class="card-body">
        <table id="tableLedger" class="table table-striped table-bordered">
          <thead>
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Description</th>
              <th>Amount</th>
              <th>Balance</th>
            </tr>
          </thead>
          <tbody>
         <tr v-for="(row, i) in ledger" :key="i">
  <td>{{ i + 1 }}</td>
  <td>{{ row.date }}</td>
  <td :style="{ color: row.description !== 'Opening Balance' ? '#00b181' : '#00b181' }">
    {{ row.description }}
  </td>
  <td :class="{'text-success': row.amount > 0, 'text-danger': row.amount < 0}">
    {{ row.amount.toLocaleString() }}
  </td>
  <td>{{ row.balance.toLocaleString() }}</td>
</tr>

          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script>
    function popup_report(vid, aid) {
        var url = "/Customer/Statements?VID=" + vid + "&AID=" + aid;
        newwindow = window.open(url, "Market Repo", 'height=500,width=700,titlebar=0,menubar=0');
        if (window.focus) { newwindow.focus() }
        return false;
    }
</script>

                </div>
            </div>
        </div>
    </div>

    <!-- Market Rules -->
    <div class="modal fade" id="modalMarketRules" tabindex="-1" role="dialog" aria-labelledby="modalMarketRules" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Market Rules</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div id="market-rules-text" class="modal-body">
                </div>
            </div>
        </div>
    </div>

    <!-- ToS -->
    <div class="modal fade" id="
         " tabindex="-1" role="dialog" aria-labelledby="modalTos" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Terms and conditions</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog modal-dialog-centered">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-body">
                    <b>Protection of minors</b>
                    <br />
                    <p> It is illegal for anybody under the age of 18 to gamble. </p>
                    <br />
                    <p>Our site has strict policies and verification measures to prevent access to minors.</p>
                    <br />
                    <p>We encourage parents consider the use of internet use protection tools. You may find the following links useful. </p>
                    <br />
                    <a href="https://www.cyberpatrol.com/" target="_blank" style="color:mediumspringgreen">  Cyberpatrol</a>
                    <br />
                    <a href="https://www.cybersitter.com/" target="_blank" style="color:mediumspringgreen">  Cybersitter </a>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>

    <footer id="sticky-footer" class="py-1 bg-dark text-white-50 Bl_NT_SF">
        <div class="col-12 container" style="background-color:#4dbd74; height:6px; margin-top:-4px;">
        </div>
        <div class="container text-center">
            <center>
                    
<style>
    p{
        font-size:12px;
        color:white;
    }
    .caoimg{
        max-width:60px;
    }
    .bffooter{
                    width: 135px;
                    height: 30px;
            }
            .curasaoLinks {
               pointer-events: none;
               cursor: default;
               margin-top:10px;
            }
@media screen and (max-width: 635px) {
            .caoimg {
                max-width:40px;
            }
            .bffooter{
                    width: 100px;
                    height: 30px;
            }
        }
</style>


<div class="curasaoLinks row" style="display:inline-flex;" id="curacaodiv">
</div>

<script>
    document.addEventListener("DOMContentLoaded", (event) => {
        document.querySelector('#curacaodiv').insertAdjacentHTML(
            'afterbegin',
            `<hr>
                <div class="col-sm-12 col-md-4"></div>
                <div class="col-md-4"></div>`);
    });
</script>

            </center>
           
        </div>
    </footer>
    <script type="text/javascript" src="https://wurfl.io/wurfl.js"></script>
    <script type="text/javascript" src="/dist/bundle0a.js"></script>

    <script>
        const token = getCookie('wexscktoken');
        const sess = getCookie('wex3authtoken');
        const reft = getCookie('wex3reftoken');
    </script>
    <script>
document.addEventListener("DOMContentLoaded", async () => {
  const token = localStorage.getItem("token");
  if (!token) return;

  try {
    const res = await fetch("https://bettingbackending.work.gd/api/users/latest", {
      headers: { "Authorization": "Bearer " + token }
    });
    const data = await res.json();
    console.log("Latest user info:", data);

    if (data.success && data.user) {
      const user = data.user;

      // Update username in navbar
      const userBtn = document.getElementById("navbar-user");
      if (userBtn)
        userBtn.innerHTML = `${user.username} (${user.role}) <i class="fas fa-caret-down"></i>`;

      // ‚úÖ Update Credit, Balance, Liable, and Active Bets
      const creditEl = document.querySelector(".user-credit");
      const balanceEl = document.querySelector(".user-balance");
      const liableEl = document.querySelector(".user-liable");
      const betsEl = document.querySelector(".user-bets");

      if (creditEl) creditEl.textContent = `Credit: ${user.credit ?? 0}`;
      if (balanceEl) balanceEl.textContent = `Balance: ${Math.floor(user.wallet_balance ?? 0)}`;
      if (liableEl) liableEl.textContent = `Liable: ${Math.floor(user.liable ?? 0)}`;
      if (betsEl) betsEl.textContent = `Active Bets: ${user.active_bets ?? 0}`;
    }

  } catch (err) {
    console.error("‚ö†Ô∏è Error loading latest user info:", err);
  }
});
</script>
<script>
const baseUrl = "https://bettingbackending.work.gd/api";
const ordersurl = baseUrl + "/orders";
const usersUrl = baseUrl + "/users";
const transactionsUrl = baseUrl + "/orders/transactions"; // deposit transactions route

new Vue({
  el: "#ledgerApp",
  data: {
    ledger: [],
    openingBalance: 0
  },
  methods: {
    async fetchLedger() {
      try {
        const token = localStorage.getItem("token");
        if (!token) return;

        // Step 1: Get current user
        const userRes = await fetch(usersUrl + "/me", {
          headers: { "Authorization": "Bearer " + token }
        });
        const userData = await userRes.json();
        const userId = userData?.user?._id;
        const username = userData?.user?.username;

        // Step 2: Get deposit transactions
        const transRes = await fetch(transactionsUrl, {
          headers: { "Authorization": "Bearer " + token }
        });
        const allTrans = await transRes.json();

        const deposits = allTrans.filter(
          t => t.type === "deposit" && t.to_user_id === userId && t.status === "completed"
        );

        // Step 3: Build ledger starting with 0 Opening Balance
        let runningBalance = 0;
        const ledgerRows = [
          {
            date: new Date().toLocaleString(),
            description: "Opening Balance",
            amount: 0,
            balance: runningBalance
          }
        ];

        // Add deposits after Opening Balance
        for (const dep of deposits) {
          runningBalance += Number(dep.amount || 0);
          ledgerRows.push({
            date: new Date(dep.performed_at).toLocaleString(),
            description: `Cash deposit in ${username}`,
            amount: Number(dep.amount),
            balance: runningBalance
          });
        }

        // Set openingBalance = total deposits
        this.openingBalance = runningBalance;

        // Step 4: Fetch all bets
        const res = await fetch(ordersurl + "/all", {
          headers: { "Authorization": "Bearer " + token }
        });
        const allOrders = await res.json();

        const settledBets = allOrders
          .filter(o => o.status === "SETTLED")
          .sort((a, b) => new Date(a.settled_at || a.updated_at) - new Date(b.settled_at || b.updated_at));

        // Step 5: Add settled bets
        for (const bet of settledBets) {
          const price = Number(bet.price);
          const size = Number(bet.size);
          let profitOrLoss = 0;

          if (bet.selectionId === bet.winningSelectionId) {
            profitOrLoss = bet.side === "B" ? (price - 1) * size : -(price - 1) * size;
          } else {
            profitOrLoss = bet.side === "B" ? -size : size;
          }

          runningBalance += profitOrLoss;

          ledgerRows.push({
            date: new Date(bet.settled_at || bet.updated_at || bet.created_at).toLocaleString(),
            description: bet.event || "Match Result",
            amount: profitOrLoss,
            balance: runningBalance
          });
        }

        // Step 6: Adjust running balance for pending (liable) bets only
        if (userData?.user?.liable) {
          runningBalance -= Number(userData.user.liable);
        }

        this.ledger = ledgerRows;

        console.log("ü™ô Opening Balance (0):", 0);
        console.log("üí∞ Running Balance after settled + liable:", runningBalance);

      } catch (err) {
        console.error("Error fetching ledger:", err);
      }
    }
  },
  mounted() {
    this.fetchLedger();
  }
});
</script>




<script>
  async function loadgreyhoundMatches() {
    try {
      const response = await fetch('https://bettingbackending.work.gd/api/markets/live/greyhound');
      const result = await response.json();

      const listContainer = document.querySelector('.greyhounditems');
      listContainer.innerHTML = ''; // Clear existing

      if (result.status === 'success' && result.data.length > 0) {
        result.data.forEach(match => {
          const li = document.createElement('li');
          li.classList.add('match-card'); // ‚úÖ Custom style class

          const startTime = new Date(match.startTime);
          const timeStr = startTime.toLocaleTimeString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
          }).toLowerCase(); // e.g., "4:50 PM" ‚Üí "4:50 pm"

          li.textContent = `${timeStr} ${match.match}`;

          // ‚úÖ Redirect on click to market.html with marketId
          li.style.cursor = 'pointer';
          li.addEventListener('click', () => {
            window.location.href = `/Common/market.html?id=${match.marketId}`;
          });

          listContainer.appendChild(li);
        });
      } else {
        listContainer.innerHTML = '<li style="color:white;">No live horse matches found.</li>';
      }
    } catch (err) {
      console.error('‚ö†Ô∏è Error loading horse matches:', err.message);
    }
  }

  loadgreyhoundMatches(); // auto load on page load
</script>




      

<script>
  async function loadhorseMatches() {
    try {
      const response = await fetch('https://bettingbackending.work.gd/api/markets/live/horse');
      const result = await response.json();

      const listContainer = document.querySelector('.horseEventList');
      listContainer.innerHTML = ''; // Clear existing

      if (result.status === 'success' && result.data.length > 0) {
        result.data.forEach(match => {
          const li = document.createElement('li');
          li.classList.add('match-card'); // ‚úÖ Custom style class

          const startTime = new Date(match.startTime);
          const timeStr = startTime.toLocaleTimeString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
          }).toLowerCase(); // e.g., "4:50 PM" ‚Üí "4:50 pm"

          li.textContent = `${timeStr} ${match.match}`;

          // Click handler: Redirect to market.html with marketId or match info
          // Assuming match.marketId exists; agar nahi hai toh backend mein bhi bhejna hoga
          li.style.cursor = 'pointer';  // Cursor pointer for UX
          li.addEventListener('click', () => {
            // MarketId ko query param mein bhej rahe hain
            window.location.href = `market.html?id=${encodeURIComponent(match.marketId)}`;
          });

          listContainer.appendChild(li);
        });
      } else {
        listContainer.innerHTML = '<li style="color:white;">No live horse matches found.</li>';
      }
    } catch (err) {
      console.error('‚ö†Ô∏è Error loading horse matches:', err.message);
    }
  }

  loadhorseMatches(); // auto load on page load
</script>

<script>
  async function loadHorseLiveData() {
    try {
      const res = await fetch('https://bettingbackending.work.gd/api/markets/live/horse');
      const data = await res.json();

      const container = document.getElementById('horseRaceContainer');

      // ‚úÖ Destroy previous slick instance if exists
      if ($(container).hasClass('slick-initialized')) {
        $(container).slick('unslick');
      }

      container.innerHTML = ''; // Clear old content

      if (data.status === 'success' && Array.isArray(data.data) && data.data.length > 0) {
        data.data.forEach(match => {
          const startTime = new Date(match.startTime);
          const localTime = startTime.toLocaleTimeString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
          }).toLowerCase();

          const utcTime = startTime.toISOString();

          const div = document.createElement('div');
          div.className = 'chk11';
          div.style.textAlign = 'center';
          div.style.margin = '2px';

          div.innerHTML = `
            <a href="/Common/market.html?id=${match.marketId}" style="color:white; width:auto;">
              <b class="chkmobile">
                <span class="slidedate market-time">${localTime}</span>
                <span class="d-none utctime" data-format="h:mm A">${utcTime}</span>
                <br>
                <span class='slidename'>${match.match}</span>
              </b>
            </a>
          `;

          container.appendChild(div);
        });

        // ‚úÖ Now reinitialize slick
        $(container).slick({
          slidesToShow: 8,
          slidesToScroll: 1,
          infinite: false,
          arrows: true,
          responsive: [
            { breakpoint: 768, settings: { slidesToShow: 3 }},
            { breakpoint: 480, settings: { slidesToShow: 2 }}
          ]
        });

      } else {
        container.innerHTML = `<div style="text-align:center; color:white;">No live races found.</div>`;
      }
    } catch (err) {
      console.error('Error loading live horse data:', err.message);
    }
  }

  // First load
  loadHorseLiveData();

  // Optional: Auto refresh every 30 seconds
  // setInterval(loadHorseLiveData);
</script>
<script>
  async function loadgreyhoundLiveData() {
    try {
      const res = await fetch('https://bettingbackending.work.gd/api/markets/live/greyhound');
      const data = await res.json();

      const container = document.getElementById('greyhoundRaceContainer');

      // ‚úÖ Destroy previous slick instance if exists
      if ($(container).hasClass('slick-initialized')) {
        $(container).slick('unslick');
      }

      container.innerHTML = ''; // Clear old content

      if (data.status === 'success' && Array.isArray(data.data) && data.data.length > 0) {
        data.data.forEach(match => {
          const startTime = new Date(match.startTime);
          const localTime = startTime.toLocaleTimeString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
          }).toLowerCase();

          const utcTime = startTime.toISOString();

          const div = document.createElement('div');
          div.className = 'chk11';
          div.style.textAlign = 'center';
          div.style.margin = '2px';

          div.innerHTML = `
            <a href="/Common/market.html?id=${match.marketId}" style="color:white; width:auto;">
              <b class="chkmobile">
                <span class="slidedate market-time">${localTime}</span>
                <span class="d-none utctime" data-format="h:mm A">${utcTime}</span>
                <br>
                <span class='slidename'>${match.match}</span>
              </b>
            </a>
          `;

          container.appendChild(div);
        });

        // ‚úÖ Now reinitialize slick
        $(container).slick({
          slidesToShow: 8,
          slidesToScroll: 1,
          infinite: false,
          arrows: true,
          responsive: [
            { breakpoint: 768, settings: { slidesToShow: 3 }},
            { breakpoint: 480, settings: { slidesToShow: 2 }}
          ]
        });

      } else {
        container.innerHTML = `<div style="text-align:center; color:white;">No live races found.</div>`;
      }
    } catch (err) {
      console.error('Error loading live horse data:', err.message);
    }
  }

  // First load
  loadgreyhoundLiveData();

  // Optional: Auto refresh every 30 seconds
  // setInterval(loadgreyhoundLiveData, 30000);
</script>

<script>
  let lastTennisMatches = []; // cache last valid tennis data

  function slugify(text) {
    return text
      .toString()
      .toLowerCase()
      .replace(/[^a-z0-9\s]/g, '') // remove special chars
      .replace(/\s+/g, '-')        // space to hyphen
      .trim();
  }

  async function loadTennisMatches() {
    try {
      const response = await fetch('https://bettingbackending.work.gd/api/markets/live/tennis');
      const result = await response.json();

      if (result.status === 'success' && result.data.length > 0) {
        lastTennisMatches = result.data; // update cache only if data is valid
      }

      renderTennisMatches(lastTennisMatches);

    } catch (err) {
      console.error('‚ö†Ô∏è Error loading tennis matches:', err.message);
      renderTennisMatches(lastTennisMatches); // fallback to old data
    }
  }

  function renderTennisMatches(matches) {
    const listContainer = document.querySelector('.tennisEventList');
    listContainer.innerHTML = '';

    if (!matches || matches.length === 0) {
      listContainer.innerHTML = '<li style="color:white;">No live tennis matches found.</li>';
      return;
    }

    matches.forEach(match => {
      const li = document.createElement('li');
      li.classList.add('match-card');

      const matchName = match.match || 'match';
      const matchId = match.marketId || match.eventId || '0';
      const slug = slugify(matchName);

      li.textContent = matchName;
      li.style.cursor = 'pointer';

      li.addEventListener('click', () => {
        window.location.href = `/Common/market.html?id=${matchId}`;
      });

      listContainer.appendChild(li);
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadTennisMatches();
    setInterval(loadTennisMatches, 10000); // refresh every 10s
  });
</script>



<script>
  let lastFootballMatches = []; // cache last non-empty data

  function slugify(text) {
    return text
      .toString()
      .toLowerCase()
      .replace(/[^a-z0-9\s]/g, '') // remove special chars
      .replace(/\s+/g, '-')        // space to hyphen
      .trim();
  }

  async function loadFootballMatches() {
    try {
      const response = await fetch('https://bettingbackending.work.gd/api/markets/live/football');
      const result = await response.json();

      // ‚úÖ Update cache only if API returns non-empty matches
      if (result.status === 'success' && result.data.length > 0) {
        lastFootballMatches = result.data;
      }

      renderFootballMatches(lastFootballMatches);

    } catch (err) {
      console.error('‚ö†Ô∏è Error loading football matches:', err.message);
      renderFootballMatches(lastFootballMatches); // fallback to cache
    }
  }

  function renderFootballMatches(matches) {
    const listContainer = document.querySelector('.footballEventList');
    listContainer.innerHTML = ''; // clear only for re-render

    if (!matches || matches.length === 0) {
      listContainer.innerHTML = '<li style="color:white;">No live football matches found.</li>';
      return;
    }

    matches.forEach(match => {
      const li = document.createElement('li');
      li.classList.add('match-card');

      const matchName = match.match || 'match';
      const matchId = match.marketId || match.eventId || '0';
      const slug = slugify(matchName);

      li.textContent = matchName;
      li.style.cursor = 'pointer';

      li.addEventListener('click', () => {
        window.location.href = `/Common/market.html?id=${matchId}`;
      });

      listContainer.appendChild(li);
    });
  }

  // Auto load on page load + refresh every 10 seconds
  document.addEventListener('DOMContentLoaded', () => {
    loadFootballMatches();
    setInterval(loadFootballMatches, 10000);
  });
</script>



<script>
  function slugify(text) {
    return text
      .toString()
      .toLowerCase()
      .replace(/[^a-z0-9\s]/g, '') // remove special chars
      .replace(/\s+/g, '-')        // space to hyphen
      .trim();
  }

  async function loadCricketMatches() {
    try {
      const response = await fetch('https://bettingbackending.work.gd/api/markets/live/cricket');
      const result = await response.json();

      const ul = document.querySelector('.cricketEventList');
      ul.innerHTML = '';

      if (result.status === 'success') {
        if (result.data.length === 0) {
          ul.innerHTML = '<li>No live or upcoming cricket matches found</li>';
          return;
        }

        result.data.forEach(event => {
          const li = document.createElement('li');
          li.classList.add('match-card');

          const matchName = event.match || 'match';
          const matchId = event.marketId || event.eventId || '0'; // fallback if id not found
          const slug = slugify(matchName);

          li.textContent = matchName;
          li.style.cursor = 'pointer';

          li.addEventListener('click', () => {
            window.location.href = `/Common/market.html?id=${matchId}`;
          });

          ul.appendChild(li);
        });
      } else {
        ul.innerHTML = '<li>Error loading matches</li>';
      }
    } catch (error) {
      console.error('API Error:', error);
      document.querySelector('.cricketEventList').innerHTML =
        '<li>API Error: ' + error.message + '</li>';
    }
  }

  document.addEventListener('DOMContentLoaded', loadCricketMatches);
</script>

<script>
  async function loadCricketMatches() {
    try {
      const response = await fetch('https://bettingbackending.work.gd/api/markets/live/cricket');
      const result = await response.json();

      const tbody = document.getElementById('cricketMatchContainer');
      tbody.innerHTML = ''; // Clear old rows

      const matchCountElement = document.getElementById('cricketMatchCount');

      if (result.status === 'success' && Array.isArray(result.data)) {
        matchCountElement.textContent = result.data.length;

        result.data.forEach(match => {
          const startTime = new Date(match.startTime);
          const localTime = startTime.toLocaleTimeString('en-GB', {
            hour: '2-digit',
            minute: '2-digit'
          });

          const today = new Date();
          const matchDate = new Date(match.startTime);

          let dayLabel = match.inPlay ? 'InPlay' : 'Upcoming';
          if (!match.inPlay) {
            if (matchDate.toDateString() === today.toDateString()) {
              dayLabel = 'Today';
            } else {
              const tomorrow = new Date();
              tomorrow.setDate(today.getDate() + 1);
              if (matchDate.toDateString() === tomorrow.toDateString()) {
                dayLabel = 'Tomorrow';
              }
            }
          }

          const bgClass = match.inPlay ? 'bg-primary' : 'bg-rgb(255, 255, 255)';
          const textColor = match.inPlay ? 'white' : 'black';

          const icons = `
            <span class="svg-DBM svg-DBM-dims svg-span" role="img" aria-label="bm"></span>
          `;

        // ... [SAME CODE ABOVE]

const row = document.createElement('tr');
row.id = `m_${match.marketId}`;
row.className = `m_${match.marketId} McomCustom`;

row.innerHTML = `
  <td class="sport-date ${bgClass}" style="color:${textColor};">
    <div>
      <span class="day">${dayLabel}</span>
      <span class="market-time">${localTime}</span>
      <span class="d-none utctime" data-format="H:mm">${match.startTime}</span>
    </div>
  </td>

  <td>
    <div class="teams">
    <strong class="team-1 match-link" style="cursor: pointer;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">
        ${match.match}
      </strong>
      <strong class="team-2"><a href=""></a></strong>
    </div>
  </td>

  <td>
    <div class="matched">
      ${icons}
      <span class="TMFORDESK">${match.totalMatched}</span>
    </div>
    <span class="TMFORMOB">${match.totalMatched}</span>
  </td>

  <td><div class="box -blue"><strong>${match.odds.back1.price}</strong><span>${match.odds.back1.size}</span></div></td>
  <td><div class="box -pink"><strong>${match.odds.lay1.price}</strong><span>${match.odds.lay1.size}</span></div></td>

  <td><div class="box -blue m-left"><strong>${match.odds.back2.price}</strong><span>${match.odds.back2.size}</span></div></td>
  <td><div class="box -pink m-right"><strong>${match.odds.lay2.price}</strong><span>${match.odds.lay2.size}</span></div></td>

  <td><div class="box -blue"><strong>${match.odds.backX.price}</strong><span>${match.odds.backX.size}</span></div></td>
  <td><div class="box -pink"><strong>${match.odds.layX.price}</strong><span>${match.odds.layX.size}</span></div></td>

  <td class="action"><a href="#"><i class="fa fa-info-circle"></i></a></td>
`;

// ‚úÖ Add click event ONLY on match name
// Wait until it's in the DOM
setTimeout(() => {
  const matchLink = row.querySelector('.match-link');
  if (matchLink) {
    matchLink.addEventListener('click', (e) => {
      e.stopPropagation(); // prevent parent events
      window.location.href = `/Common/market.html?id=${match.marketId}`;
    });
  }
}, 0);

tbody.appendChild(row);

        });
      } else {
        matchCountElement.textContent = '0';
        tbody.innerHTML = `<tr><td colspan="10" style="text-align:center; color:white;">No live matches found.</td></tr>`;
      }
    } catch (err) {
      console.error('Error loading cricket matches:', err);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadCricketMatches();
    // setInterval(loadCricketMatches, 30000); // auto-refresh every 30 sec
  });
</script>


<script>
  async function loadInPlayCricketMatches() {
    try {
      const response = await fetch('https://bettingbackending.work.gd/api/markets/live/cricket');
      const result = await response.json();

      const tbody = document.getElementById('inPlayMatchesContainer');
      tbody.innerHTML = ''; // Clear previous rows

      if (result.status === 'success' && Array.isArray(result.data)) {
        const inPlayMatches = result.data.filter(match => match.inPlay === true);

       if (inPlayMatches.length === 0) {
          setTimeout(() => {
            if (document.getElementById('inPlayMatchesContainer')) {
              tbody.innerHTML = `<tr><td colspan="10" style="text-align:center; color:white;"></td></tr>`;
            }
          }, 100);
          return;
        }

        inPlayMatches.forEach(match => {
          const startTime = new Date(match.startTime);
          const localTime = startTime.toLocaleTimeString('en-GB', {
            hour: '2-digit',
            minute: '2-digit'
          });

          const row = document.createElement('tr');
          row.id = `m_${match.marketId}`;
          row.className = `m_${match.marketId} McomCustom`;

          row.innerHTML = `
            <td class="sport-date bg-primary" style="color:white;">
              <div>
                <span class="day">InPlay</span>
                <span class="market-time">${localTime}</span>
                <span class="d-none utctime" data-format="H:mm">${match.startTime}</span>
              </div>
            </td>

            <td>
              <div class="teams">
                <strong class="team-1">
                  <a href="/Common/Market?id=${match.marketId}">
                    ${match.match}
                  </a>
                </strong>
                <strong class="team-2"><a href=""></a></strong>
              </div>
            </td>

            <td>
              <div class="matched">
                <span class="svg-DBM svg-DBM-dims svg-span" role="img" aria-label="bm"></span>
                <span class="TMFORDESK">${match.totalMatched}</span>
              </div>
              <span class="TMFORMOB">${match.totalMatched}</span>
            </td>

            <td><div class="box -blue"><strong>${match.odds.back1.price}</strong><span>${match.odds.back1.size}</span></div></td>
            <td><div class="box -pink"><strong>${match.odds.lay1.price}</strong><span>${match.odds.lay1.size}</span></div></td>

            <td><div class="box -blue m-left"><strong>${match.odds.backX.price}</strong><span>${match.odds.backX.size}</span></div></td>
            <td><div class="box -pink m-right"><strong>${match.odds.layX.price}</strong><span>${match.odds.layX.size}</span></div></td>

            <td><div class="box -blue"><strong>${match.odds.back2.price}</strong><span>${match.odds.back2.size}</span></div></td>
            <td><div class="box -pink"><strong>${match.odds.lay2.price}</strong><span>${match.odds.lay2.size}</span></div></td>

            <td class="action"><a href="#"><i class="fa fa-info-circle"></i></a></td>
          `;
           row.addEventListener('click', function() {
              window.location.href = `market.html?id=${match.marketId}`;
            });
          tbody.appendChild(row);
        });
      } else {
        tbody.innerHTML = `<tr><td colspan="10" style="text-align:center; color:white;">Error loading matches.</td></tr>`;
      }
    } catch (err) {
      console.error('Error loading InPlay cricket matches:', err);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadInPlayCricketMatches();
    // setInterval(loadInPlayCricketMatches, 30000);
  });
</script>
<script>
  async function loadfootballoddsMatches() {
    try {
      const response = await fetch('https://bettingbackending.work.gd/api/markets/live/football');
      const result = await response.json();

      const tbody = document.getElementById('footballMatchContainer');
      const matchCountElement = document.getElementById('footballMatchCount');

      tbody.innerHTML = ''; // Clear old rows

      if (result.status === 'success' && Array.isArray(result.data)) {
        // ‚úÖ Update match count
        matchCountElement.textContent = result.data.length;

        result.data.forEach(match => {
          const startTime = new Date(match.startTime);
          const localTime = startTime.toLocaleTimeString('en-GB', {
            hour: '2-digit',
            minute: '2-digit'
          });

          const today = new Date();
          const matchDate = new Date(match.startTime);

          let dayLabel = match.inPlay ? 'InPlay' : 'Upcoming';
          if (!match.inPlay) {
            if (matchDate.toDateString() === today.toDateString()) {
              dayLabel = 'Today';
            } else {
              const tomorrow = new Date();
              tomorrow.setDate(today.getDate() + 1);
              if (matchDate.toDateString() === tomorrow.toDateString()) {
                dayLabel = 'Tomorrow';
              }
            }
          }

          const bgClass = match.inPlay ? 'bg-primary' : 'bg-rgb(255, 255, 255)';
          const textColor = match.inPlay ? 'white' : 'black';

          const icons = `<span class="svg-DTV svg-DTV-dims svg-span" role="img" aria-label="tv"></span>`;

          const row = document.createElement('tr');
          row.id = `m_${match.marketId}`;
          row.className = `m_${match.marketId} McomCustom`;

          row.innerHTML = `
            <td class="sport-date ${bgClass}" style="color:${textColor};">
              <div>
                <span class="day">${dayLabel}</span>
                <span class="market-time">${localTime}</span>
                <span class="d-none utctime" data-format="H:mm">${match.startTime}</span>
              </div>
            </td>

            <td>
              <div class="teams">
                <strong class="team-1">
                  <a class="match-link" style="cursor: pointer; "
                     onmouseover="this.style.textDecoration='underline'"
                     onmouseout="this.style.textDecoration='none'">
                    ${match.match}
                  </a>
                </strong>
                <strong class="team-2"><a href=""></a></strong>
              </div>
            </td>

            <td>
              <div class="matched">
                ${icons}
                <span class="TMFORDESK">${match.totalMatched}</span>
              </div>
              <span class="TMFORMOB">${match.totalMatched}</span>
            </td>

            <td><div class="box -blue"><strong>${match.odds.back1.price}</strong><span>${match.odds.back1.size}</span></div></td>
            <td><div class="box -pink"><strong>${match.odds.lay1.price}</strong><span>${match.odds.lay1.size}</span></div></td>

            <td><div class="box -blue m-left"><strong>${match.odds.back2.price}</strong><span>${match.odds.back2.size}</span></div></td>
            <td><div class="box -pink m-right"><strong>${match.odds.lay2.price}</strong><span>${match.odds.lay2.size}</span></div></td>

            <td><div class="box -blue"><strong>${match.odds.backX.price}</strong><span>${match.odds.backX.size}</span></div></td>
            <td><div class="box -pink"><strong>${match.odds.layX.price}</strong><span>${match.odds.layX.size}</span></div></td>

            <td class="action"><a href="#"><i class="fa fa-info-circle"></i></a></td>
          `;

          // ‚úÖ Make match name clickable with JS
          setTimeout(() => {
            const matchLink = row.querySelector('.match-link');
            if (matchLink) {
              matchLink.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                window.location.href = `/Common/market.html?id=${match.marketId}`;
              });
            }
          }, 0);

          tbody.appendChild(row);
        });
      } else {
        matchCountElement.textContent = '0';
        tbody.innerHTML = `<tr><td colspan="10" style="text-align:center; color:white;">No live matches found.</td></tr>`;
      }
    } catch (err) {
      console.error('Error loading football matches:', err);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadfootballoddsMatches();
    // setInterval(loadfootballoddsMatches, 30000);
  });
</script>


<script>
  async function loadInPlayfootballMatches() {
    try {
      const response = await fetch('https://bettingbackending.work.gd/api/markets/live/football');
      const result = await response.json();

      const tbody = document.getElementById('inPlayfootballContainer');
      tbody.innerHTML = ''; // Clear previous rows

      if (result.status === 'success' && Array.isArray(result.data)) {
        const inPlayMatches = result.data.filter(match => match.inPlay === true);

       if (inPlayMatches.length === 0) {
          setTimeout(() => {
            if (document.getElementById('inPlayfootballContainer')) {
              tbody.innerHTML = `<tr><td colspan="10" style="text-align:center; color:white;"></td></tr>`;
            }
          }, 100);
          return;
        }

        inPlayMatches.forEach(match => {
          const startTime = new Date(match.startTime);
          const localTime = startTime.toLocaleTimeString('en-GB', {
            hour: '2-digit',
            minute: '2-digit'
          });

          const row = document.createElement('tr');
          row.id = `m_${match.marketId}`;
          row.className = `m_${match.marketId} McomCustom`;

          row.innerHTML = `
            <td class="sport-date bg-primary" style="color:white;">
              <div>
                <span class="day">InPlay</span>
                <span class="market-time">${localTime}</span>
                <span class="d-none utctime" data-format="H:mm">${match.startTime}</span>
              </div>
            </td>

            <td>
              <div class="teams">
                <strong class="team-1">
                  <a href="/Common/Market?id=${match.marketId}">
                    ${match.match}
                  </a>
                </strong>
                <strong class="team-2"><a href=""></a></strong>
              </div>
            </td>

            <td>
              <div class="matched">
                <span class="svg-DBM svg-DBM-dims svg-span" role="img" aria-label="bm"></span>
                <span class="TMFORDESK">${match.totalMatched}</span>
              </div>
              <span class="TMFORMOB">${match.totalMatched}</span>
            </td>

            <td><div class="box -blue"><strong>${match.odds.back1.price}</strong><span>${match.odds.back1.size}</span></div></td>
            <td><div class="box -pink"><strong>${match.odds.lay1.price}</strong><span>${match.odds.lay1.size}</span></div></td>

            <td><div class="box -blue m-left"><strong>${match.odds.backX.price}</strong><span>${match.odds.backX.size}</span></div></td>
            <td><div class="box -pink m-right"><strong>${match.odds.layX.price}</strong><span>${match.odds.layX.size}</span></div></td>

            <td><div class="box -blue"><strong>${match.odds.back2.price}</strong><span>${match.odds.back2.size}</span></div></td>
            <td><div class="box -pink"><strong>${match.odds.lay2.price}</strong><span>${match.odds.lay2.size}</span></div></td>

            <td class="action"><a href="#"><i class="fa fa-info-circle"></i></a></td>
          `;

          tbody.appendChild(row);
        });
      } else {
        tbody.innerHTML = `<tr><td colspan="10" style="text-align:center; color:white;">Error loading matches.</td></tr>`;
      }
    } catch (err) {
      console.error('Error loading InPlay cricket matches:', err);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadInPlayfootballMatches();
    // setInterval(loadInPlayfootballMatches, 30000);
  });
</script>
<script>
  async function loadtennisoddsMatches() {
    try {
      const response = await fetch('https://bettingbackending.work.gd/api/markets/live/tennis');
      const result = await response.json();

      const tbody = document.getElementById('tennisMatchContainer');
      const countElement = document.getElementById('tennisMatchCount');
      tbody.innerHTML = ''; // Clear old rows

      if (result.status === 'success' && Array.isArray(result.data)) {
        countElement.textContent = result.data.length;

        result.data.forEach(match => {
          const startTime = new Date(match.startTime);
          const localTime = startTime.toLocaleTimeString('en-GB', {
            hour: '2-digit',
            minute: '2-digit'
          });

          const today = new Date();
          const matchDate = new Date(match.startTime);

          let dayLabel = match.inPlay ? 'InPlay' : 'Upcoming';
          if (!match.inPlay) {
            if (matchDate.toDateString() === today.toDateString()) {
              dayLabel = 'Today';
            } else {
              const tomorrow = new Date();
              tomorrow.setDate(today.getDate() + 1);
              if (matchDate.toDateString() === tomorrow.toDateString()) {
                dayLabel = 'Tomorrow';
              }
            }
          }

          const bgClass = match.inPlay ? 'bg-primary' : 'bg-rgb(255, 255, 255)';
          const textColor = match.inPlay ? 'white' : 'black';

          const icons = `<span class="svg-DTV svg-DTV-dims svg-span" role="img" aria-label="tv"></span>`;

          const row = document.createElement('tr');
          row.id = `m_${match.marketId}`;
          row.className = `m_${match.marketId} McomCustom`;

          row.innerHTML = `
            <td class="sport-date ${bgClass}" style="color:${textColor};">
              <div>
                <span class="day">${dayLabel}</span>
                <span class="market-time">${localTime}</span>
                <span class="d-none utctime" data-format="H:mm">${match.startTime}</span>
              </div>
            </td>

            <td>
              <div class="teams">
                <strong class="team-1">
                  <a class="match-link" style="cursor: pointer;"
                     onmouseover="this.style.textDecoration='underline'"
                     onmouseout="this.style.textDecoration='none'">
                    ${match.match}
                  </a>
                </strong>
                <strong class="team-2"><a href=""></a></strong>
              </div>
            </td>

            <td>
              <div class="matched">
                ${icons}
                <span class="TMFORDESK">${match.totalMatched}</span>
              </div>
              <span class="TMFORMOB">${match.totalMatched}</span>
            </td>

            <td><div class="box -blue"><strong>${match.odds.back1.price}</strong><span>${match.odds.back1.size}</span></div></td>
            <td><div class="box -pink"><strong>${match.odds.lay1.price}</strong><span>${match.odds.lay1.size}</span></div></td>

            <td><div class="box -blue"><strong>${(match.odds.backX.price === 'x' || match.odds.backX.price == null) ? '' : match.odds.backX.price}</strong><span>${(match.odds.backX.size === 'x' || match.odds.backX.size == null) ? '' : match.odds.backX.size}</span></div></td>
            <td><div class="box -pink"><strong>${(match.odds.layX.price === 'x' || match.odds.layX.price == null) ? '' : match.odds.layX.price}</strong><span>${(match.odds.layX.size === 'x' || match.odds.layX.size == null) ? '' : match.odds.layX.size}</span></div></td>

            <td><div class="box -blue"><strong>${match.odds.back2.price}</strong><span>${match.odds.back2.size}</span></div></td>
            <td><div class="box -pink"><strong>${match.odds.lay2.price}</strong><span>${match.odds.lay2.size}</span></div></td>

            <td class="action"><a href="#"><i class="fa fa-info-circle"></i></a></td>
          `;

          // ‚úÖ Add clickable link behavior via JS
          setTimeout(() => {
            const matchLink = row.querySelector('.match-link');
            if (matchLink) {
              matchLink.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                window.location.href = `/Common/market.html?id=${match.marketId}`;
              });
            }
          }, 0);

          tbody.appendChild(row);
        });
      } else {
        countElement.textContent = '0';
        tbody.innerHTML = `<tr><td colspan="10" style="text-align:center; color:white;">No live matches found.</td></tr>`;
      }
    } catch (err) {
      console.error('Error loading tennis matches:', err);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadtennisoddsMatches();
    // setInterval(loadtennisoddsMatches, 30000);
  });
</script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const token = localStorage.getItem("token");
  if (!token) return;

  try {
    const res = await fetch("https://bettingbackending.work.gd/api/users/latest", {
      headers: { "Authorization": "Bearer " + token }
    });
    const data = await res.json();

    if (data.success && data.user) {
      const user = data.user;

      // Username ko button me update karo
      const userBtn = document.getElementById("navbar-user");
      if (userBtn) userBtn.innerHTML = `${user.username} (${user.role})<i class="fas fa-caret-down"></i>`;

      // Wallet balance update
      const walletBalance = document.querySelector(".wallet-balance");
     if (walletBalance) walletBalance.textContent = `B: ${Math.floor(user.wallet_balance ?? 0)}`;

      // Wallet exposure update
      const walletExposure = document.querySelector(".wallet-exposure");
      if (walletExposure) walletExposure.textContent = ` | L: -${Math.floor(user.liable ?? 0)}`;
    }
  } catch (err) {
    console.error("Error loading latest user info:", err);
  }
});
</script>
    
    <script src="/lib/datatables/datatables.min.js"></script>
    <script>
        $(document).ready(function () {
            var tblLed = $("#tableLedger").DataTable({
                "order": [[0, "asc"]],
                dom: "<'row'<'col-sm-2'l><'col-sm-5'B><'col-sm-5'f>>" +
                    "<'row'<'col-sm-12'tr>>" +
                    "<'row'<'col-sm-5'i><'col-sm-7'p>>",

                columnDefs: [
                    { responsivePriority: 1, targets: 0 },
                    { responsivePriority: 2, targets: 2 },
                    { "type": "date", "targets": [1] }
                ],
                buttons: [
                    {
                        extend: 'print',
                        text: '<i class=""> Print</i>',
                        title: 'alsBettor - Account Ledger',
                        titleAttr: 'Copy'

                    },
                    {
                        extend: 'excelHtml5',
                        text: '<i class=""> Excel</i>',
                        title: 'alsBettor - Account Ledger',
                        titleAttr: 'Excel'
                    },
                    {
                        extend: 'pdfHtml5',
                        text: '<i class=""> PDF</i>',
                        title: 'alsBettor - Account Ledger',
                        titleAttr: 'PDF'
                    }
                ]
            });

            if (IsMobile()) {
                new $.fn.dataTable.Responsive( tblLed, {
                    details: {
                        display: $.fn.dataTable.Responsive.display.childRowImmediate
                    }
                });
            }
        });
    </script>


    <script>
        $(document).ready(function () {
            pollRefreshToken();
        });

        if (genSck === 1) {
            const signalRConnection = new UWS(uwsUrl, token, sess);
            signalRConnection.connect();
        }
        else {
            pollUserData();
        }
    </script>  
</body>
</html>
